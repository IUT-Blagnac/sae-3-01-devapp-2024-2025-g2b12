= Documentation Technique
:compat-mode!:
:toc:
:toc-title: Sommaire
:toclevels: 3
:icons: font
:stem: latexmath

// paramères relatif à GitHub
ifdef::env-github[]
:note-caption: :information_source:
:stem: latexmath
endif::[]

// page de garde
// -------------
<<<
---
// logos IUT Blagnac + UT2J
[.text-center]
image::./res/iut-blagnac.jpg[Logo IUT de Blagnac, 200]
[.text-center]
image::./res/ut2j.jpg[Logo Université Toulouse II - Jean Jaurès, 200]
[.text-center]
*Étudiants* +
Nolhan Biblocque +
Léo Guinvarc'h +
Victor Jockin +
Mathys Laguilliez +
Mucahit Lekesiz
[.text-center]
*Enseignant* +
André Péninou
[.text-center]
*Formation* +
BUT Informatique +
2ème Année +
Promotion 2024-2025 +
[.text-center]
*Établissement* +
IUT de Blagnac +
Université Toulouse II – Jean Jaurès (31)

<<<
== *1. Présentation de l'application*

<<<
== *2. Architecture de l'application*

=== 2.1 Architecture générale

==== *2.1.1 Sous-systèmes de l'application*

===== *_Application JavaFX_*
===== *_Programme Python_*

==== *2.1.2 Fichiers utilisés*

===== *_Fichier de configuration_*

Le fichier de configuration `configuration.ini` situé sous le répertoire `resources` contient les paramètres de la configuration créée par l'utilisateur au travers de l'interface de l'application Java. Ce fichier est lu par le programme Python à son lancement qui adapte ainsi son comportement en fonction des paramètres spécifiés.

STRUCTURE DU FICHIER::

[source,ini]
----
[MQTT] ; [1]
broker=mqtt.iut-blagnac.fr
port=1883
topic={{ PRÉFIXE DES TOPIC MQTT }}

[SUBJECTS] ; [2]
subject1={{ SUJET 1 }}
subject2={{ SUJET 2 }}
...

[DATA_TYPE] ; [3]
dataType1={{ TYPE DE DONNÉES 1 }}
dataType2={{ TYPE DE DONNÉES 2 }}
dataType3={{ TYPE DE DONNÉES 3 }}
...

[THRESHOLD] ; [4]
{{ TYPE DE DONNÉES 1 }}={{ SEUIL }}
{{ TYPE DE DONNÉES 2 }}={{ SEUIL }}
{{ TYPE DE DONNÉES 3 }}={{ SEUIL }}
...

[PARAMS] ; [5]
frequency={{ FRÉQUENCE }}
----

*[1] Paramètres de connexion MQTT*

    * `broker` : Adresse du broker MQTT (valeur fixe).
    * `port` : Port utilisé pour la connexion au broker (port standard MQTT, valeur fixe).
    * `topic` : Préfixe des topics auxquels le programme Python doit s'abonner.
        ** Pour accès aux capteurs AM107, le préfixe correspondant est `AM107/by-room/`.
        ** Pour accès aux capteurs SOLAREDGE, le préfixe correspondant est `solaredge/blagnac/`.

*[2] Liste des sujets à observer*

    * `subjectI` : I-ème sujet à observer.
        ** Pour les capteurs AM107, le nombre de sujets à observer peut aller jusqu'au nombre total de salles disponibles, soit 53.
        ** Pour les capteurs SOLAREDGE, le nombre de sujets à observer se limite à 1 : `overview`.

*[3] Liste des types de données à récupérer*

    * `dataTypeI` : I-ème type de données à récupérer pour le type de capteurs consulté.

*[4] Liste des seuils d'alerte par type de données (capteurs AM107 uniquement)*

    * Cette section indique, pour chaque type de données listé dans la section `DATA_TYPE`, le seuil dont le dépassement déclenchera une alerte.

*[5] Paramètres avancés*

    * `frequency` : Fréquence de lecture des données.
        ** *À noter :* La valeur pour ce paramètre n'a actuellement aucun impact sur le comportement du programme Python car non traitée. La fréquence définie lors du paramétrage de la configuration est cependant prise en compte par le processus de lecture des données de l'application Java.

===== *_Fichiers de données_*

Les fichiers de données situés sous le répertoire `resources/data` sont des fichiers CSV permettant de stocker les données des capteurs. Ces fichiers sont créés et remplis par le programme Python et lus par l'application Java.

La première ligne de chaque fichier CSV contient les en-têtes décrivant la nature des données des lignes suivantes (lignes de données).

*À noter :* Dans les fichiers CSV manipulés, le séparateur de données utilisé est le point-virgule (`;`).

====== Fichier de données global

Le fichier `data.csv` correspond au fichier de données global. Il contient les dernières données reçues pour chaque sujet.
    
    * Dans le cas des capteurs AM107, une ligne de données du fichier correspond aux dernières données reçues pour une salle.
    * Dans le cas des capteurs SOLAREDGE, la seule ligne de données présente dans le fichier correspond aux dernières données reçues pour le panneau solaire.

Ce fichier est utilisé par l'application Java pour :

    * Afficher dans le tableau de bord les données en temps réel pour chaque sujet observé.
    * Générer des diagrammes de comparaison des sujets sur un type de données.

STRUCTURE DU FICHIER::
[source,csv]
----
{{ TYPE DE SUJET }};{{ TYPE DE DONNEE 1 }};{{ TYPE_DE DONNEE 2 }}
{{ SUJET 1 }};{{ VALEUR MESURÉE }};{{ VALEUR MESURÉE }}
{{ SUJET 2 }};{{ VALEUR MESURÉE }};{{ VALEUR MESURÉE }}
{{ SUJET 3 }};{{ VALEUR MESURÉE }};{{ VALEUR MESURÉE }}
...
----

====== Fichier d'alertes (capteurs AM107 uniquement)

Le fichier `alert.csv` correspond au fichier d'alertes. Il contient l'ensemble des alertes déclenchées par des dépassements de seuils. Une ligne de données du fichier correspond donc à une alerte pour un type de données et pour une salle.

Ce fichier est utilisé par l'application Java afin d'afficher les alertes en temps réel dans le tableau de bord.

STRUCTURE DU FICHIER::
[source,csv]
----
room;dataType;threshold;measuredValue
{{ SALLE 1 }};{{ TYPE DE DONNÉES }};{{ SEUIL }};{{ VALEUR MESURÉE }}
{{ SALLE 2 }};{{ TYPE DE DONNÉES }};{{ SEUIL }};{{ VALEUR MESURÉE }}
...
----

====== Fichiers de données par sujet

Les fichiers dont le nom est de la forme `SUJET.csv` correspondent chacun à un fichier de données pour un sujet en particulier. Un fichier de ce type contient l'historique des données reçues pour un sujet.

    * Dans le cas des capteurs AM107, autant de fichiers sont créés que de sujets sont observés. Les noms de ces fichiers correspondent aux noms des salles observées (exemple : `B101.csv`).
    * Dans le cas des capteurs SOLAREDGE, un seul fichier nommé `overview` est créé.

Ces fichiers sont exploités par l'application Java afin de construire des graphiques décrivant l'évolution des valeurs pour un type de données.

STRUCTURE DU FICHIER::
[source,csv]
----
{{ TYPE DE SUJET }};{{ TYPE DE DONNEE 1 }};{{ TYPE_DE DONNEE 2 }}
{{ SUJET }};{{ VALEUR MESURÉE À L'INSTANT T0 }};{{ VALEUR MESURÉE À L'INSTANT T0 }}
{{ SUJET }};{{ VALEUR MESURÉE À L'INSTANT T1 }};{{ VALEUR MESURÉE À L'INSTANT T1 }}
{{ SUJET }};{{ VALEUR MESURÉE À L'INSTANT T2 }};{{ VALEUR MESURÉE À L'INSTANT T2 }}
...
----

==== *2.1.3 Interactions entre sous-systèmes et fichiers*
. *Écriture du fichier de configuration par l'application Java*
    * Après le paramétrage d'une configuration par l'utilisateur dans l'interface graphique, l'application Java crée un fichier `configuration.ini` sour le répertoire `resources` décrivant la configuration créée.
	* *À noter :* À cette étape, si un fichier de configuration existe déjà, celui-ci est remplacé par le fichier de configuration nouvellement créé. Aucun mécanisme d'historisation ou de sauvegarde des fichiers de configurations n'a été mis en place.
. *Lancement du programme Python par l'application Java*
	* Une fois le fichier de configuration créé, l'application Java démarre le processus de collecte des données en lançant en exécution le programme Python.
. *Collecte des données par le programme Python*
	* Au lancement, le programme Python lis le fichier de configuration définissant son comportement.
	* Une fois lancé, il attend jusqu'à interruption les données envoyées par les sujets (capteurs).
	* À chaque réception de données, celles-ci sont enregistrées dans les fichiers de données correspondants.
. *Lecture des fichiers de données par l'application Java*
	* En parallèle de l'exécution du programme Python, l'application Java lis à intervalle régulier (fréquence définie dans le fichier de configuration) les fichiers de données.
	* Les données lues sont ensuite stockées dans des structures de données puis transmises au tableau de bord de l'application pour affichage.
. *Interruption du programme Python par l'application Java*
	* Lorsque le tableau de bord de l'application est fermé par l'utilisateur, le programme Python est automatiquement arrêté.
	* *À noter :* Après arrêt du processus de collecte des données, le fichier de configuration ainsi que les fichiers de données écrits sont conservés. Ils seront écrasés lors de la prochaine exécution de l'application.

=== 2.2 Ressources externes

==== *2.2.1 API utilisées*

===== *_JavaFX_*

    * *Rôles :*
        ** Conception de l'IHM avec le module `javafx-fxml` (création d'interfaces utilisateur via des fichiers FXML).
        ** Prise en charge et gestion de l'interface graphique dans l'application.
    * *Version utilisée :* 17
    * *Site officiel de JavaFX :* https://openjfx.io/[JavaFX - Home]
    * *Documentation officielle :* https://www.oracle.com/java/technologies/javase/javafx-docs.html[Oracle - JavaFX Documentation]

===== *_OpenCSV_*

    * *Rôle :* Lecture des fichiers de données au format `CSV` générés par le programme python collecteur de données.
    * *Version utilisée :* 5.5.2
    * *Site officiel de JavaFX :* https://opencsv.sourceforge.net/[OpenCSV - About / Opencsv Users Guide]
    * *Documentation officielle :* https://opencsv.sourceforge.net/#developer_documentation[OpenCSV - About / Developer Documentation]

==== *2.2.2 Plugins utilisés*

===== *_JavaFX Maven Plugin_*

    * *Rôle :* Packaging et exécution de l'application JavaFX.
    * *Version utilisée :* 0.0.8
    * *Site officiel de Maven Repository :* https://mvnrepository.com/artifact/org.openjfx/javafx-maven-plugin[Maven Repository - JavaFX Maven Plugin Maven Mojo]
    * *Lien vers le dépôt GitHub du plugin :* https://github.com/openjfx/javafx-maven-plugin[GitHub - Maven plugin for JavaFX]

===== *_Apache Maven Shade Plugin_*

    * *Rôle :* Création d'un exécutable au format `JAR` contenant toutes les dépendances nécessaires au fonctionnement de l'application.
    * *Version utilisée :* 3.4.1
    * *Site officiel d'Apache Maven :* https://maven.apache.org/plugins/maven-shade-plugin/[Apache Maven Project - Apache Maven Shade Plugin]

===== *_Apache Maven Javadoc Plugin_*

    * *Rôle :* Génération de la documentation du projet Java avec `Javadoc`.
    * *Version utilisée :* 3.4.1
    * *Site officiel d'Apache Maven :* https://maven.apache.org/plugins/maven-javadoc-plugin/[Apache Maven Project - Apache Maven Javadoc Plugin]

=== 2.3 Structuration de l'application

=== 2.4 Spécifications techniques

<<<
== *3. Conception et mise en oeuvre fonctionnalités*

<<<
== *4. Procédures d'installation*

=== 4.1 Installation pour développement

==== *4.1.1 Prérequis*
. *Installer l'environnement de développement Java*
    * Télécharger le *JDK 17* (ou version compatible) depuis le site officiel d'Oracle : https://www.oracle.com/fr/java/technologies/downloads/[Oracle - Java Downloads].
    * Installer le JDK en suivant les instructions indiquées par l'installateur.
    * Si nécessaire, ajouter le chemin vers le JDK à la variable d'environnement `PATH`.
    * Dans un terminal, vérifier l'installation avec la commande `java -version` ou `java --version`.
. *Installer Apache Maven*
    * Télécharger *Maven* (archive ZIP) depuis le site officiel d'Apache Maven : https://maven.apache.org/download.cgi[Apache Maven Project - Downloading Apache Maven].
        ** Pour une installation sur Linux ou Mac OS, télécharger la *_Binary tar.gz archive_*.
        ** Pour une installation sur Windows, télécharger la *_Binary zip archive_*.
    * Ajouter le chemin vers Maven à la variable d'environnement `PATH`.
    * Dans un terminal, vérifier l'installation avec la commande `mvn -version`, `mvn --version` ou `mvn -v`.
. *Configurer un IDE*
    * Si nécessaire, installer des plugins de prise en charge de *Maven* et *JavaFX* dans l'IDE utilisé pour le développement.

==== *4.1.2 Étapes d'installation*
. *Cloner le dépôt du projet*
    * Accéder au dépôt GitHub du projet : https://github.com/IUT-Blagnac/sae-3-01-devapp-2024-2025-g2b12?tab=readme-ov-file[GitHub - SAE S3.01 DevApp]
    * Cloner le dépôt du projet via la commande :
    
    git clone https://github.com/IUT-Blagnac/sae-3-01-devapp-2024-2025-g2b12.git

    * Accéder au répertoire du projet Java situé sous `solution iot/application_iot` via la commande :

    cd solution\ iot/application_iot

. *Construire le projet avec Maven*
    * Supprimer les fichiers et ressources précédemment compilés avec la commande `mvn clean` puis compiler le projet Java via la commande `mvn install`. Il est également possible d'utiliser directement la commande `mvn clean install`.
. *Exécuter l'application depuis Maven*
    * Exécuter le projet JavaFX via la commande `mvn javafx:run`.

=== 4.2 Installation pour utilisation

==== *4.2.1 Prérequis*
. *Installer le Java Runtime Environement (JRE)*
    * Vérifier que Java est installé sur la machine en exécutant la commande `java -version` dans un terminal.
    * Si Java n'est pas installé, télécharger et installer le *JRE 8* ou version ultérieure depuis le site officiel de Java : https://www.java.com/fr/[Java - Télécharger Java].
. *Installer Python 3*
    * Vérifier que Python en version 3 est installé sur la machine en exécutant la commande `python -version` ou `python3 -version` dans un terminal.
    * Si Python n'est pas installé, télécharger et installer la dernière version disponible sur le site officiel de Python : https://www.python.org/downloads/[Python - Downloads].

==== *4.2.2 Étapes d'installation*
. *Télécharger l'application*
    * Télécharger l'archive de l'application (fichier ZIP) située sous le répertoire `livrables/IoT` du dépôt GitHub du projet : https://github.com/IUT-Blagnac/sae-3-01-devapp-2024-2025-g2b12/tree/master/livrables/IoT[GitHub - Livrables IoT]
        ** Pour une installation sur Mac OS, préférer l'archive `application_jar_mac_os.zip`.
        ** Pour une installation sur Windows ou Linux, préférer l'archive `application_jar_windows.zip`.
. *Décompresser l'archive de l'application*
    * Décompresser l'archive téléchargée dans un répertoire à l'aide d'un outil de décompression tel que *WinRAR* ou *7-Zip*.
    * L'arborescence de l'application après décompression doit ressembler à ceci :

    application/
    |-- ressources/
    |   |-- data/
    |   |-- configuration.ini
    |   |-- mqtt.py
    |-- application_iot-1.0-SNAPSHOT-shaded.jar

==== *4.2.3 Étapes de lancement*
. *Lancer l'application dans le gestionnaire de fichiers*
    * Lancer l'exécutable `application_iot-1.0-SNAPSHOT-shaded.jar` en double-cliquant sur celui-ci.
    * _Le menu principal de l'application devrait alors apparaître à l'écran._
. *Lancer l'application en ligne de commande*
    * Ouvrir un terminal et se placer dans le répertoire `application` à l'aide de la commande `cd`.
    * Lancer ensuite l'exécutable de l'application via la commande :
    
    java -jar application_iot-1.0-SNAPSHOT-shaded.jar

    * _Le menu principal de l'application devrait alors apparaître à l'écran._

// page de fin
// -----------
<<<
---
[.text-center]
*Étudiants* +
Nolhan Biblocque +
Léo Guinvarc'h +
Victor Jockin +
Mathys Laguilliez +
Mucahit Lekesiz
[.text-center]
*Enseignant* +
André Péninou
[.text-center]
*Formation* +
BUT Informatique +
2ème Année +
Promotion 2024-2025 +
[.text-center]
*Établissement* +
IUT de Blagnac +
Université Toulouse II – Jean Jaurès (31)